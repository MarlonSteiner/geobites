<!-- Map section -->
<div id="map">
</div>
<!-- Output section -->
<div class="output-background d-flex justify-content-center">
  <div>City Country Emoji</div>
  <div>Output</div>
  <div>Learn more & Bookmark</div>
</div>
<!-- Image section -->
<div class="d-flex justify-content-center mb-94">
  <%= image_tag "travel_section.svg", id: "travel-section" %>
</div>
<!-- How it works section -->
<div class="text-center mb-76">
  <h2>How it works</h2>
</div>

<div class="d-flex justify-content-center mb-240">
  <%= image_tag "how-section.svg", id: "how-section" %>
</div>

<!-- Javascript is taken from docs and not something I could just come up by myself -->
<script>
  mapboxgl.accessToken = '<%= ENV["MAPBOX_TOKEN"] %>';

  const map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/satellite-v9',
    projection: 'globe',
    zoom: 1.5,
    center: [0, 20]
  });

  map.on('click', async (e) => {
    const { lat, lng } = e.lngLat;

    // Call Mapbox reverse geocoding
    const response = await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${lng},${lat}.json?access_token=${mapboxgl.accessToken}&types=place,country`);
    const data = await response.json();

    const city = data.features[0]?.text || 'Unknown';
    const country = data.features[0]?.context?.find(c => c.id.includes('country'))?.text || 'Unknown';

    // Display it
    document.getElementById('location-title').textContent = `${city}, ${country}`;
    document.getElementById('output-text').textContent = 'Fact will go here';
    document.getElementById('output-card').style.display = 'block';
  });
</script>
